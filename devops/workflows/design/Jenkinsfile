#!/usr/bin/env groovy 

pipeline {
    agent none
    parameters {
        choice(
            name: 'PROTOCOL', 
            choices: ['fixbb', 'binder', 'hallucination'], 
            description: '')
        string(name: 'JOB_NAME', defaultValue: 'colabdesign', description: 'Name of the job')
        string(name: 'num_seqs', defaultValue: '1', description: 'How many sequences to design per input')
        file(name: 'structures_file.maegz', description: 'Upload your file')
        file(name: 'design_parameters.csv', description: 'Upload your file')
        stashedFile 'structures_file'
        stashedFile 'design_parameters'
    }
    stages {
        stage('Run colabdesign') {
            agent {
                label "gpu-cloud"
            }
            environment {
                SCHRODINGER = "/mnt/squashsuites/suite2023-3-build081"
            }
            steps {
                unstash 'structures_file'
                unstash 'design_parameters'
                sh 'ls'
                // sh 'source devops/workflows/design/set_sdgr_and_gcp.sh'
                // sh 'source devops/workflows/design/install_colabdesign.sh'
                // sh 'source devops/workflows/design/run_colabdesign.sh'
            }
        }
        // stage('Collect results') {
        //     agent {
        //         label "docker-cloud"
        //     }
        //     environment {
        //         USER_PASS_SECRET = credentials('suraj-jenkins-password')
        //         POSTGRES_PASSWORD = credentials('ld_etc_db_gcs')
        //     }
        //     steps {
        //         sh 'rm -rf results'
        //         sh 'mkdir -p results'
        //         sh 'chmod +x ./scripts/dashboard_backtest/collect_results.sh'
        //         sh './scripts/dashboard_backtest/collect_results.sh'
        //         sh 'tar -czf results.tar.gz results'
        //     }
 
        // }
    }
}
